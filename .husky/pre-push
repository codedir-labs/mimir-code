# Full validation before push
echo "ğŸ” Running full validation..."
yarn validate || {
  echo "âŒ Validation failed - push blocked"
  echo "Run 'yarn validate' locally to see details"
  exit 1
}
echo "âœ… Validation passed (typecheck + lint + tests)"

# Security audit (moderate level for pushes)
echo "ğŸ”’ Running security audit..."
yarn audit --level moderate || {
  AUDIT_EXIT_CODE=$?
  if [ $AUDIT_EXIT_CODE -ge 16 ]; then
    echo "âŒ Audit failed with error"
    exit 1
  elif [ $AUDIT_EXIT_CODE -gt 0 ]; then
    echo "âŒ Moderate+ vulnerabilities found - push blocked"
    echo "Run 'yarn audit' to review and fix vulnerabilities"
    exit 1
  fi
}
echo "âœ… Security audit passed"

echo ""
echo "ğŸš€ All checks passed - pushing..."
